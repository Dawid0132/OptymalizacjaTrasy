<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{{ url_for('static',filename='favicon.ico') }}" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet"/>
    <link rel="stylesheet" href="{{ url_for('static',filename='main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='HomePage/homepage.css') }}">
    {% block css %}
    <link rel="stylesheet" href="{{ url_for('static',filename='Dashboard/dashboard.css') }}">
    {% endblock %}
    <title>SmartRoute</title>
</head>
<body>
<nav class="navbar">
    <div class="container-fluid">
        <a class="navbar-brand custom_link" href="{{ url_for('dashboard_api.index') }}"><span
                class="sunset">SmartRoute</span></a>
        <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
                aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="#f6d8ae" class="bi bi-list"
                 viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                      d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"></path>
            </svg>
        </button>
        <div style="background-color: #2e4057" class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
             aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header d-flex flex-row">
                <div class="col">
                    <h5 class="offcanvas-title sunset" id="offcanvasNavbarLabel">SmartRoute</h5>
                </div>
                <div class="col d-flex justify-content-end align-items-center">
                    <button class="align-self-end" style="background: none; border: none;" type="button"
                            data-bs-dismiss="offcanvas"
                            aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#f6d8ae"
                             class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="offcanvas-body">
                <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                    <li class="nav-item">
                        <a class="nav-link custom_link" aria-current="page"
                           href="{{ url_for('user_api.profile') }}"><span
                                class="sunset">Profil</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link custom_link" href="{{ url_for('map_api.selectCoordinates') }}"><span
                                class="sunset">Generowanie trasy</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link custom_link" href="{{ url_for('trip_api.upcoming') }}"><span
                                class="sunset">Planowane trasy</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link custom_link" href="{{ url_for('trip_api.history') }}"><span class="sunset">Historia tras</span></a>
                    </li>
                    <li class="nav-item">
                        <form id="logout" style="padding: 0.7em;">
                            <button class="btn btn-primary" type="submit">Wyloguj</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<div class="d-flex justify-content-center align-items-center" style="height: 100vh">
    {% block spinner %}
    {% endblock %}
    {% block content %}
    <div class="col-12 d-flex justify-content-start align-items-center masthead">
        <div class="w-100 h-100 d-flex justify-content-start align-items-center mastheadImage dashboard_logo">
        </div>
    </div>
    {% endblock %}
</div>
<section class="section" id="Footer">
    <div style="background-color: #2e4057;" class="shadow">
        <div class="d-flex flex-row p-5">
            <div class="col text-white">
                SmartRoute © 2025 Company, Inc
            </div>
        </div>
    </div>
</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $('#logout').on('submit', function (e) {
        e.preventDefault();
        const user_id = JSON.parse(localStorage.getItem('user_id'))
        $.ajax({
            type: 'GET',
            url: `/user/signout/${user_id}`,
            success: function () {
                window.location.href = '/smartroute/homePage'
            },
            error: function (xhr) {
                console.error('Błąd wylogowania:', xhr.responseText)
            }
        })
    })
</script>
{% block script %}
<script>
    function geoLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            alert("Geolokalizacja nie jest wspierana przez tą przeglądarkę")
        }
    }

    function showPosition(position) {
        let lat = position.coords.latitude;
        let lon = position.coords.longitude;

        $.ajax({
            url: `/user/location`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                latitude: lat,
                longitude: lon
            }),
            success: function (response) {
                console.log(response.status)
            },
            error: function (e) {
                console.error("Error getting location: " + e)
            }
        })
    }

    function showError(e) {
        alert("Nie udało się pobrać lokalizacji");
    }

    window.onload = geoLocation;

</script>
{% endblock %}
</body>
</html>